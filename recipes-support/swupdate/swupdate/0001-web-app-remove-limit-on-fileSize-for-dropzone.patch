From 936cf9ff8010835f3683c645da077657a057a5bc Mon Sep 17 00:00:00 2001
From: Stefano Babic <sbabic@denx.de>
Date: Wed, 8 Aug 2018 11:46:21 +0200
Subject: [PATCH] web-app: remove limit on fileSize for dropzone

Default limit in dropzone is just 256MB. Remove it by setting
the maximum to 4GB.

Signed-off-by: Stefano Babic <sbabic@denx.de>
---
 examples/www/v2/js/swupdate.min.js | 2 +-
 web-app/js/swupdate.js             | 3 ++-
 2 files changed, 3 insertions(+), 2 deletions(-)

diff --git a/examples/www/v2/js/swupdate.min.js b/examples/www/v2/js/swupdate.min.js
index 8743984..201d201 100644
--- a/examples/www/v2/js/swupdate.min.js
+++ b/examples/www/v2/js/swupdate.min.js
@@ -4,4 +4,4 @@
  *
  * SPDX-License-Identifier: MIT
  */
-function restart(){$.post("restart",{},function(s){showRestart()})}function showRestart(){$("#swu-restart-modal").modal({backdrop:"static",keyboard:!1}),window.setTimeout(tryReload,3e3)}function tryReload(){$.ajax({cache:!1,timeout:1e3,success:function(s){window.location.reload(!0)},error:function(s,e,a){"timeout"===e?tryReload():window.setTimeout(tryReload,1e3)}})}function updateStatus(s){switch($("#swu-idle").hide(),$("#swu-success").hide(),$("#swu-failure").hide(),$("#swu-done").hide(),$("#swu-run").hide(),s){case"IDLE":$("#swu-idle").show();break;case"START":case"RUN":$("#swu-run").show();break;case"SUCCESS":$("#swu-success").show();break;case"FAILURE":$("#swu-failure").show();break;case"DONE":$("#swu-done").show()}}var updateProgressBarStatus=function(s){var e="";return function(s){switch($("#swu-progress-bar").removeClass("bg-danger bg-success progress-bar-animated"),$("#swu-progress-spinner").removeClass("fa-spinner fa-spin"),$("#swu-progress-run").hide(),s){case"START":updateProgressBar(0,"","");break;case"RUN":$("#swu-progress-bar").addClass("progress-bar-animated"),$("#swu-progress-spinner").addClass("fa-spinner fa-spin"),$("#swu-progress-run").show();break;case"SUCCESS":$("#swu-progress-bar").addClass("bg-success");break;case"FAILURE":"START"===e&&"RUN"===e||updateProgressBar(0,"",""),$("#swu-progress-bar").addClass("bg-danger")}e=s}}();function updateProgressBar(s,e,a){$("#swu-progress-value").text(a),$("#swu-progress-name").text(e),$("#swu-progress-bar").css("width",s+"%").attr("aria-valuenow",s)}Dropzone.options.dropzone={timeout:0,clickable:!0,acceptedFiles:".swu"},window.onload=function(){var s;$("#swu-restart").click(restart),s="https:"===window.location.protocol?"wss:":"ws:";var e=new WebSocket(s+"//"+window.location.host+window.location.pathname.replace(/\/[^\/]*$/,"")+"/ws");e.onopen=function(s){updateStatus("IDLE")},e.onclose=function(s){showRestart()},e.onmessage=function(s){var e=JSON.parse(s.data);switch(e.type){case"message":var a=$("<p></p>");a.text(e.text),a.addClass("mb-1"),e.level<=3&&a.addClass("text-danger"),$("#messages").append(a);break;case"status":updateStatus(e.status),updateProgressBarStatus(e.status);break;case"source":break;case"step":var r=Math.round((100*(Number(e.step)-1)+Number(e.percent))/Number(e.number)),t=r+"% ("+e.step+" of "+e.number+")";updateProgressBar(r,e.name,t)}}};
\ No newline at end of file
+function restart(){$.post("restart",{},function(s){showRestart()})}function showRestart(){$("#swu-restart-modal").modal({backdrop:"static",keyboard:!1}),window.setTimeout(tryReload,3e3)}function tryReload(){$.ajax({cache:!1,timeout:1e3,success:function(s){window.location.reload(!0)},error:function(s,e,a){"timeout"===e?tryReload():window.setTimeout(tryReload,1e3)}})}function updateStatus(s){switch($("#swu-idle").hide(),$("#swu-success").hide(),$("#swu-failure").hide(),$("#swu-done").hide(),$("#swu-run").hide(),s){case"IDLE":$("#swu-idle").show();break;case"START":case"RUN":$("#swu-run").show();break;case"SUCCESS":$("#swu-success").show();break;case"FAILURE":$("#swu-failure").show();break;case"DONE":$("#swu-done").show()}}var updateProgressBarStatus=function(s){var e="";return function(s){switch($("#swu-progress-bar").removeClass("bg-danger bg-success progress-bar-animated"),$("#swu-progress-spinner").removeClass("fa-spinner fa-spin"),$("#swu-progress-run").hide(),s){case"START":updateProgressBar(0,"","");break;case"RUN":$("#swu-progress-bar").addClass("progress-bar-animated"),$("#swu-progress-spinner").addClass("fa-spinner fa-spin"),$("#swu-progress-run").show();break;case"SUCCESS":$("#swu-progress-bar").addClass("bg-success");break;case"FAILURE":"START"===e&&"RUN"===e||updateProgressBar(0,"",""),$("#swu-progress-bar").addClass("bg-danger")}e=s}}();function updateProgressBar(s,e,a){$("#swu-progress-value").text(a),$("#swu-progress-name").text(e),$("#swu-progress-bar").css("width",s+"%").attr("aria-valuenow",s)}Dropzone.options.dropzone={timeout:0,clickable:!0,acceptedFiles:".swu",maxFilesize:4096},window.onload=function(){var s;$("#swu-restart").click(restart),s="https:"===window.location.protocol?"wss:":"ws:";var e=new WebSocket(s+"//"+window.location.host+window.location.pathname.replace(/\/[^\/]*$/,"")+"/ws");e.onopen=function(s){updateStatus("IDLE")},e.onclose=function(s){showRestart()},e.onmessage=function(s){var e=JSON.parse(s.data);switch(e.type){case"message":var a=$("<p></p>");a.text(e.text),a.addClass("mb-1"),e.level<=3&&a.addClass("text-danger"),$("#messages").append(a);break;case"status":updateStatus(e.status),updateProgressBarStatus(e.status);break;case"source":break;case"step":var r=Math.round((100*(Number(e.step)-1)+Number(e.percent))/Number(e.number)),t=r+"% ("+e.step+" of "+e.number+")";updateProgressBar(r,e.name,t)}}};
\ No newline at end of file
diff --git a/web-app/js/swupdate.js b/web-app/js/swupdate.js
index 34f3e3e..c02407b 100755
--- a/web-app/js/swupdate.js
+++ b/web-app/js/swupdate.js
@@ -107,7 +107,8 @@ function updateProgressBar (percent, name, value) {
 Dropzone.options.dropzone = {
   timeout: 0,
   clickable: true,
-  acceptedFiles: '.swu'
+  acceptedFiles: '.swu',
+  maxFilesize: 4096
 }
 
 window.onload = function () {
-- 
2.7.4

